$schema: "http://json-schema.org/draft-07/schema#"
title: Obligation Explanation Payload (v1)
type: object
required:
  - version
  - explanations
properties:
  version:
    const: obligation.explanation.v1
    type: string
  explanations:
    type: array
    items:
      $ref: "#/definitions/explanation"
definitions:
  span:
    type: array
    items:
      - type: integer
      - type: integer
    minItems: 2
    maxItems: 2
  atom:
    type: object
    required: [text, normalized]
    properties:
      text:
        type: string
      normalized:
        type: string
      span:
        oneOf:
          - $ref: "#/definitions/span"
          - type: "null"
      content_span:
        oneOf:
          - $ref: "#/definitions/span"
          - type: "null"
      clause_id:
        type: string
    additionalProperties: false
  scope_atom:
    allOf:
      - $ref: "#/definitions/atom"
      - type: object
        required: [category]
        properties:
          category:
            type: string
            enum: [time, place, context]
  lifecycle_atom:
    allOf:
      - $ref: "#/definitions/atom"
      - type: object
        required: [kind]
        properties:
          kind:
            type: string
            enum: [activation, termination]
  condition_atom:
    type: object
    required: [type, clause_id]
    properties:
      type:
        type: string
      span:
        oneOf:
          - $ref: "#/definitions/span"
          - type: "null"
      content_span:
        oneOf:
          - $ref: "#/definitions/span"
          - type: "null"
      clause_id:
        type: string
    additionalProperties: false
  explanation:
    type: object
    required:
      - clause_id
      - modality
      - atoms
      - reference_identities
    properties:
      clause_id:
        type: string
      modality:
        type: string
      type:
        type: string
      source_span:
        oneOf:
          - $ref: "#/definitions/span"
          - type: "null"
      atoms:
        type: object
        required: [conditions, scopes, lifecycle]
        properties:
          actor:
            oneOf:
              - $ref: "#/definitions/atom"
              - type: "null"
          action:
            oneOf:
              - $ref: "#/definitions/atom"
              - type: "null"
          object:
            oneOf:
              - $ref: "#/definitions/atom"
              - type: "null"
          conditions:
            type: array
            items:
              $ref: "#/definitions/condition_atom"
          scopes:
            type: array
            items:
              $ref: "#/definitions/scope_atom"
          lifecycle:
            type: array
            items:
              $ref: "#/definitions/lifecycle_atom"
        additionalProperties: false
      reference_identities:
        type: array
        items:
          type: string
        uniqueItems: true
    additionalProperties: false
additionalProperties: false
